--- 
  pool: 
    demands: 
      - npm
    vmImage: ubuntu-16.04
  steps: 
    - 
      task: UseDotNet@2
      displayName: "Use .NET Core SDK 3.1.100"
      inputs: 
        packageType: sdk
        version: "3.1.100"
      
    - 
      task: Npm@1
      displayName: "Run npm install"
      inputs: 
        verbose: false
      
    - 
      script: "./node_modules/.bin/node-sass Tailspin.SpaceGame.Web/wwwroot --output Tailspin.SpaceGame.Web/wwwroot"
      displayName: "Compile Sass assets"
    - 
      task: gulp@1
      displayName: "Run gulp tasks"
    - 
      
      script: "echo \"$(Build.DefinitionName), $(Build.BuildId), $(Build.BuildNumber)\" > buildinfo.txt"
      workingDirectory: Tailspin.SpaceGame.Web/wwwroot
      displayName: "Write build info"
    - 
      task: DotNetCoreCLI@2
      inputs: 
        command: restore
        projects: "**/*.csproj"
      
      displayName: "Restore project dependencies"
    - 
      task: DotNetCoreCLI@2
      displayName: "Build the project - Release"
      inputs: 
        arguments: "--no-restore --configuration Release"
        command: build
        projects: "**/*.csproj"
      
    - 
        task: DotNetCoreCLI@2
        displayName: 'Publish the project - Release'
        inputs:
          command: 'publish'
          projects: '**/*.csproj'
          publishWebProjects: false
          arguments: '--no-build --configuration Release --output $(Build.ArtifactStagingDirectory)/Release'
          zipAfterPublish: true
         
      
    - 
      task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: drop'
      condition: succeeded() 
      
  trigger: 
    - "*"
  variables: 
    buildConfiguration: Release
  